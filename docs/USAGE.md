# 通用抢票软件框架使用说明

## 快速开始

### 1. 环境准备

#### 系统要求
- Python 3.8+
- Android设备（用于大麦网APP抢票）
- ADB工具

#### 安装依赖
```bash
pip install -r requirements.txt
```

#### 安装ADB
- **Windows**: 下载Android SDK Platform Tools
- **macOS**: `brew install android-platform-tools`
- **Linux**: `sudo apt-get install android-tools-adb`

### 2. 设备连接

#### 开启USB调试
1. 在手机上进入"设置" > "关于手机"
2. 连续点击"版本号"7次，开启开发者选项
3. 进入"开发者选项"，开启"USB调试"
4. 用USB线连接手机和电脑

#### 验证连接
```bash
adb devices
```
应该显示已连接的设备列表。

### 3. 运行程序

```bash
python main.py
```

## 功能说明

### 配置管理

#### 用户配置
- 设置用户名和密码
- 配置手机号和邮箱（可选）
- 设置自动登录和会话超时

#### 平台配置
- 大麦网平台配置
- API端点和请求头设置
- 超时和重试参数

#### 抢票任务配置
- 活动ID
- 目标价格
- 座位偏好
- 抢票数量
- 重试参数

### 安全说明
- 程序只负责抢票到待支付页面
- 不进行实际的支付操作
- 用户需要手动完成支付
- 避免自动支付的安全风险

### 反检测机制
- **设备指纹随机化**: 每次请求使用不同的设备指纹
- **请求头轮换**: 动态更新User-Agent等请求头
- **频率限制**: 控制请求频率，避免触发反爬虫机制
- **随机延迟**: 在请求间添加随机延迟，模拟人类行为
- **会话轮换**: 定期轮换会话，避免会话被检测
- **验证码检测**: 自动检测并处理验证码
- **安全验证检测**: 检测滑块验证、图片验证等安全措施
- **人性化行为模拟**: 模拟真实用户的操作模式

### 高级隐身机制
- **隐身会话管理**: 完全隐藏自动化特征
- **追踪保护**: 实时检测和阻止追踪行为
- **隐私保护**: 自动清理敏感信息和用户数据
- **反指纹技术**: 随机化所有可能的设备指纹
- **行为伪装**: 模拟真实用户的思考和行为模式
- **网络隐身**: 随机化IP地址和网络参数
- **自动化检测规避**: 掩盖所有自动化信号

### 抢票流程

#### 大麦网APP抢票流程
1. **设备检查**: 验证手机连接状态
2. **APP启动**: 启动大麦网APP
3. **登录检查**: 验证用户登录状态
4. **活动搜索**: 搜索指定活动
5. **进入详情**: 进入活动详情页
6. **选择票档**: 根据价格选择合适票档
7. **选择座位**: 根据偏好选择座位
8. **提交订单**: 提交抢票订单
9. **等待支付页面**: 等待进入待支付页面

### 高级功能

#### 并发抢票
- 支持多个任务同时执行
- 可配置最大工作线程数
- 智能任务调度

#### 重试机制
- 自动重试失败的任务
- 可配置重试次数和间隔
- 指数退避算法

#### 日志记录
- 详细的运行日志
- 按日期自动分割
- 错误日志单独记录

#### 配置备份
- 配置文件自动备份
- 支持配置恢复
- 配置验证功能

## 配置示例

### 用户配置
```json
{
  "username": "your_username",
  "password": "your_password",
  "phone": "13800138000",
  "email": "user@example.com",
  "auto_login": true,
  "session_timeout": 3600
}
```

### 抢票任务配置
```json
{
  "event_id": "123456",
  "platform": "damai",
  "target_price": 580.0,
  "seat_preference": ["A区", "B区"],
  "quantity": 2,
  "retry_times": 3,
  "retry_interval": 1.0
}
```

## 注意事项

### 使用建议
1. **合理设置频率**: 避免过于频繁的请求
2. **遵守条款**: 遵守平台使用条款
3. **测试验证**: 在测试环境中先验证功能
4. **备份配置**: 定期备份重要配置
5. **手动支付**: 抢票成功后请及时手动完成支付
6. **安全监控**: 关注安全报告，及时调整策略
7. **代理使用**: 如需要，可配置代理池避免IP限制
8. **隐身模式**: 启用高级隐身机制，确保完全隐蔽
9. **追踪监控**: 实时监控追踪行为，及时阻止
10. **隐私保护**: 定期清理敏感数据，保护用户隐私

### 故障排除

#### 设备连接问题
- 检查USB线是否正常
- 确认USB调试已开启
- 尝试重新插拔USB线

#### APP启动失败
- 确认大麦网APP已安装
- 检查APP权限设置
- 尝试手动启动APP

#### 抢票失败
- 检查网络连接
- 确认活动ID正确
- 查看详细错误日志

## 扩展开发

### 添加新平台
1. 继承`GrabStrategy`基类
2. 实现`execute`和`can_handle`方法
3. 在`GrabEngine`中注册策略

### 自定义抢票逻辑
1. 修改平台适配器
2. 调整抢票流程
3. 优化成功率

## 技术支持

### 日志文件位置
- 主日志: `logs/grab_tickets_YYYY-MM-DD.log`
- 错误日志: `logs/error_YYYY-MM-DD.log`

### 配置文件位置
- 用户配置: `config/user_config.json`
- 平台配置: `config/platform_config.json`
- 任务配置: `config/ticket_requests.json`
- 应用设置: `config/settings.json`

### 常见问题
1. **Q: 为什么抢票总是失败？**
   A: 请检查网络连接、活动ID是否正确、是否已登录APP

2. **Q: 如何提高抢票成功率？**
   A: 可以调整重试次数、优化网络环境、选择合适的票档

3. **Q: 支持哪些平台？**
   A: 目前支持大麦网，框架设计支持扩展其他平台

4. **Q: 如何添加新的抢票策略？**
   A: 参考大麦网适配器的实现，继承基类并实现相应方法

5. **Q: 如何避免被检测？**
   A: 启用反检测机制，合理设置请求频率，使用代理池

6. **Q: 遇到验证码怎么办？**
   A: 程序会自动检测验证码，需要人工处理或集成验证码识别服务

7. **Q: 如何监控安全状态？**
   A: 查看安全报告，关注违规次数和可疑活动

8. **Q: 如何确保完全隐身？**
   A: 启用高级隐身机制，包括设备指纹随机化、行为伪装、追踪保护等

9. **Q: 如何防止被追踪？**
   A: 使用追踪保护功能，实时检测和阻止追踪行为，清理敏感数据

10. **Q: 如何保护隐私？**
    A: 启用隐私保护功能，自动清理敏感信息，匿名化用户数据 